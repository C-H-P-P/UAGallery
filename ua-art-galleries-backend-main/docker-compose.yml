# version: '3.8'

services:
  # ‚ùå –õ–û–ö–ê–õ–¨–ù–ê –ë–î –ù–ê–ú –ë–Ü–õ–¨–®–ï –ù–ï –¢–†–ï–ë–ê (–∑–∞–∫–æ–º–µ–Ω—Ç—É–≤–∞–≤ —ó—ó)
  # db:
  #   image: postgres:15
  #   environment:
  #     - POSTGRES_DB=${DB_NAME}
  #     - POSTGRES_USER=${DB_USER}
  #     - POSTGRES_PASSWORD=${DB_PASSWORD}
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   ports:
  #     - "5432:5432"
  #   env_file:
  #     - .env
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U postgres"]
  #     interval: 5s
  #     timeout: 5s
  #     retries: 10

  # === BACKEND (Django) ===
  backend:
    build: ./backend
    # üëá –ó–ú–Ü–ù–ê 1: –ü—Ä–∏–±—Ä–∞–ª–∏ wait-for-db.sh. Neon –ø—Ä–∞—Ü—é—î –∑–∞–≤–∂–¥–∏, —á–µ–∫–∞—Ç–∏ –Ω–µ —Ç—Ä–µ–±–∞.
    command: sh -c "python manage.py migrate --noinput && python manage.py runserver 0.0.0.0:8000"
    volumes:
      - ./backend:/app
    ports:
      - "8000:8000"
    # üëá –ó–ú–Ü–ù–ê 2: –í–∫–∞–∑—É—î–º–æ —à–ª—è—Ö –¥–æ .env (–ø–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —Ñ–∞–π–ª –ª–µ–∂–∏—Ç—å —Å–∞–º–µ —Ç–∞–º)
    # –Ø–∫—â–æ .env –ª–µ–∂–∏—Ç—å –≤ –ø–∞–ø—Ü—ñ backend, —Ç–æ —à–ª—è—Ö: ./backend/.env
    # –Ø–∫—â–æ –≤ –∫–æ—Ä–µ–Ω—ñ (–±—ñ–ª—è docker-compose), —Ç–æ –ø—Ä–æ—Å—Ç–æ: .env
    env_file:
      - ./backend/.env 
    
    # üëá –ó–ú–Ü–ù–ê 3: –û—á–∏—Å—Ç–∏–ª–∏ environment. 
    # Docker —Å–∞–º –≤—ñ–∑—å–º–µ –≤—Å–µ –∑ —Ñ–∞–π–ª—É .env. –î—É–±–ª—é–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ —Ç—É—Ç –ù–ï–ë–ï–ó–ü–ï–ß–ù–û, 
    # –±–æ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –ø–µ—Ä–µ–∫—Ä–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Neon.
    # environment:
      # - DJANGO_DEBUG=${DJANGO_DEBUG}
      
    # üëá –ó–ú–Ü–ù–ê 4: –ü—Ä–∏–±—Ä–∞–ª–∏ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ –ª–æ–∫–∞–ª—å–Ω–æ—ó –±–∞–∑–∏
    # depends_on:
    #   db:
    #     condition: service_healthy 
    
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  postgres_data: